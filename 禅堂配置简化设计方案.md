# 禅堂配置简化设计方案

**设计日期**: 2025-11-15  
**目标用户**: 禅修中心服务人员、义工（非技术人员）  
**设计原则**: 简单、直观、自动化

---

## 一、设计目标

### 1.1 核心目标

- **零学习成本**: 用户不需要理解复杂的坐标系统、sections概念
- **自动化配置**: 系统自动读取学员数据和课程设置，智能生成配置
- **最小调整**: 用户只需调整简单的行列数即可完成配置
- **模板驱动**: 基于3种实际场景的模板，覆盖所有使用情况

### 1.2 用户场景

根据实际禅修中心情况，禅堂配置只有3种场景：

1. **A区（女众独立园区）**: 单性设置，禅堂中仅女众区域
2. **B区（男众独立园区）**: 单性设置，禅堂中仅男众区域  
3. **混合园区**: 男女众在一起上课，禅堂中包含男女众区域，双性设置（根据课程需要也可以实现单性设置）

**人数限制**:
- 单性课程: 通常不超过100人
- 双性课程: 通常不超过150人

---

## 二、模板系统设计

### 2.1 三种模板类型

#### 模板1: A区（女众独立园区）

**适用场景**:
- 女众单性课程
- 禅堂中只有女众区域
- 人数通常不超过100人

**配置特点**:
- 单一区域，全部为女众
- 编号方式：顺序编号（1, 2, 3...）
- 座位前缀：A（或根据中心自定义）

**布局建议**:
- 前2-3排：旧生优先区域
- 后续排：新生区域
- 自动根据旧生/新生人数比例分配

#### 模板2: B区（男众独立园区）

**适用场景**:
- 男众单性课程
- 禅堂中只有男众区域
- 人数通常不超过100人

**配置特点**:
- 单一区域，全部为男众
- 编号方式：顺序编号（1, 2, 3...）
- 座位前缀：B（或根据中心自定义）

**布局建议**:
- 前2-3排：旧生优先区域
- 后续排：新生区域
- 自动根据旧生/新生人数比例分配

#### 模板3: 混合园区（双性课程）

**适用场景**:
- 男女众混合课程
- 禅堂中包含男女众两个区域
- 人数通常不超过150人
- 注意：双性课程必须同时有男女众学员，不会存在只有一种性别的情况

**配置特点**:
- 两个区域：女众区（左侧）和男众区（右侧）
- 编号方式：顺序编号，但带前缀区分性别
  - 男众区：A1, A2, A3, A4...（A=男众）
  - 女众区：B1, B2, B3, B4...（B=女众）
- 座位前缀：A=男众，B=女众

**布局建议**:
- 女众区：前2-3排旧生，后续新生,如果有法师 默认放在最前面
- 男众区：前2-3排旧生，后续新生,如果有法师 默认放在最前面
- 根据实际男女比例自动调整区域大小

---

## 三、自动配置流程

### 3.1 数据自动读取

系统在选择模板后，自动读取以下数据：

#### 3.1.1 学员数据统计

**自动统计**:
- 总学员数
- 女众人数
- 男众人数
- 旧生人数（按性别）
- 新生人数（按性别）
- 法师人数（按性别，如果有）

**数据来源**: 当前期次的学员列表

#### 3.1.2 课程设置读取

**自动读取**:
- 课程性别类型（单性/双性）
- 中心名称（用于生成区域名称）
- 其他课程配置

**数据来源**: Session表和课程配置

### 3.2 智能配置生成

#### 3.2.1 模板选择建议

系统根据读取的数据，自动推荐合适的模板：

**推荐逻辑**:
- 如果课程类型为"单性"且只有女众 → 推荐模板1（A区）
- 如果课程类型为"单性"且只有男众 → 推荐模板2（B区）
- 如果课程类型为"双性" → 推荐模板3（混合园区）
  - 注意：双性课程必须同时有男女众，不会存在只有一种性别的情况

#### 3.2.2 行列数自动计算

**计算原则**:
- 考虑10-15%的冗余空间（预留座位）
- 单性课程：总人数 × 1.15，不超过100人
- 双性课程：总人数 × 1.15，不超过150人

**行列数计算**:
- 根据总人数和冗余比例计算总容量
- 根据禅堂实际尺寸比例（通常列数6-10，行数10-20）自动计算
- 提供推荐值，用户可微调

**示例**:
- 单性课程80人 → 容量92座 → 推荐：12行×8列=96座
- 双性课程120人（女60+男60）→ 容量138座 → 推荐：15行×10列=150座
  - 女众区：15行×5列=75座
  - 男众区：15行×5列=75座

#### 3.2.3 区域划分自动生成

**单性模板（A区/B区）**:
- 自动计算旧生/新生比例
- 前2-3排分配给旧生区（根据旧生人数调整）
- 后续排分配给新生区
- 如果旧生人数少，可以减少旧生区行数

**双性模板（混合园区）**:
- 根据男女比例自动划分左右区域
- 女众区在左侧，男众区在右侧
- 每个区域内部再按旧生/新生划分
- 如果某性别人数很少，可以调整区域比例

### 3.3 配置预览和确认

**自动生成后显示**:
- 可视化布局预览
- 容量统计（总容量、已报名人数、使用率）
- 区域划分说明（旧生区、新生区、男女区域）
- 编号方式说明

**用户确认**:
- 如果满意，直接保存
- 如果不满意，可以调整行列数

---

## 四、用户操作流程

### 4.1 简化后的操作步骤

#### 步骤1: 选择模板

**界面显示**:
- 3个大卡片，分别对应3种模板
- 每个卡片显示：
  - 模板名称（A区/B区/混合园区）
  - 适用场景说明
  - 推荐标识（如果系统推荐）

**用户操作**:
- 点击选择模板（或使用系统推荐）

#### 步骤2: 自动生成配置

**系统自动执行**:
- 读取学员数据
- 读取课程设置
- 计算行列数
- 生成区域划分
- 生成完整配置

**界面显示**:
- 加载动画
- "正在分析学员数据..."
- "正在生成配置..."

#### 步骤3: 预览和微调

**界面显示**:
- 可视化布局预览（网格图）
- 容量统计卡片
- 行列数调整控件（简单易用）

**用户操作**:
- 查看预览
- 如果容量不足或过多，调整行列数
- 系统实时更新预览

#### 步骤4: 保存配置

**用户操作**:
- 点击"保存配置"按钮
- 系统保存到数据库

---

## 五、界面设计要点

### 5.1 模板选择界面

**设计原则**:
- 大卡片式设计，一目了然
- 每个卡片包含：
  - 大标题（A区/B区/混合园区）
  - 图标（可选）
  - 适用场景文字说明
  - 推荐标签（如果系统推荐）

**布局**:
- 3个卡片横向排列（或2+1布局）
- 卡片足够大，易于点击
- 选中状态明显（边框高亮）

### 5.2 配置预览界面

**设计原则**:
- 可视化为主，文字为辅
- 实时反馈，所见即所得

**组件**:
- **布局网格图**: 显示行列、区域划分、容量
- **统计卡片**: 
  - 总容量
  - 已报名人数
  - 使用率（百分比，颜色提示）
  - 各区域人数分布
- **调整控件**: 
  - 行数滑块或输入框
  - 列数滑块或输入框
  - 实时更新预览

### 5.3 行列数调整界面

**设计原则**:
- 简单直观
- 提供推荐值和范围提示

**控件设计**:
- 行数输入框（带范围提示：10-20行）
- 列数输入框（带范围提示：6-10列）
- 实时容量计算显示
- 超出范围警告提示

**智能提示**:
- "当前容量80座，已报名75人，使用率94%，建议增加1-2行"
- "当前容量150座，已报名120人，使用率80%，容量充足"

---

## 六、智能推荐算法

### 6.1 模板推荐逻辑

**推荐优先级**:
1. 根据课程性别类型推荐
2. 根据实际学员性别分布推荐
3. 如果两者不一致，以实际数据为准

**推荐规则**:
- 单性课程 + 只有女众 → 模板1（A区）
- 单性课程 + 只有男众 → 模板2（B区）
- 双性课程 → 模板3（混合园区）
  - 注意：双性课程必须同时有男女众学员，系统会验证此条件

### 6.2 行列数推荐算法

**输入参数**:
- 总学员数
- 课程类型（单性/双性）
- 男女比例（如果是双性）

**计算步骤**:
1. 计算目标容量 = 总学员数 × 1.15（15%冗余）
2. 根据课程类型确定行列比例范围
3. 在范围内找到最接近目标容量的行列组合
4. 如果是双性，按男女比例分配列数

**推荐示例**:
- 80人单性 → 92座 → 推荐12行×8列=96座
- 120人双性（60女+60男）→ 138座 → 推荐15行×10列=150座
  - 女众区：15行×5列=75座
  - 男众区：15行×5列=75座

### 6.3 区域划分算法

**单性模板**:
- 计算旧生/新生比例
- 旧生区：前2-3排（根据旧生人数调整，最少1排，最多3排）
- 新生区：剩余所有排
- 如果旧生人数很少，可以减少旧生区行数

**双性模板**:
- 计算男女比例
- 女众区列数 = 总列数 × (女众人数 / 总人数)
- 男众区列数 = 总列数 - 女众区列数
- 每个区域内部再按旧生/新生划分（同单性模板）

---

## 七、配置验证和提示

### 7.1 容量验证

**验证规则**:
- 总容量必须 ≥ 已报名人数
- 建议容量 ≥ 已报名人数 × 1.1（10%冗余）

**提示信息**:
- ✅ 容量充足：绿色提示
- ⚠️ 容量紧张（使用率>90%）：黄色警告
- ❌ 容量不足（使用率>100%）：红色错误，阻止保存

### 7.2 区域划分验证

**验证规则**:
- 旧生区容量必须 ≥ 旧生人数
- 新生区容量必须 ≥ 新生人数
- 双性模板：女众区容量 ≥ 女众人数，男众区容量 ≥ 男众人数

**提示信息**:
- 如果某个区域容量不足，提示增加对应区域的行数或列数
- 提供具体建议："旧生区容量不足，建议增加1-2行"

### 7.3 配置完整性验证

**验证项**:
- 模板已选择
- 行列数已设置
- 区域划分已生成
- 编号方式已确定

**提示信息**:
- 如果缺少必要配置，阻止保存并提示

---

## 八、与现有系统的集成

### 8.1 数据来源

**学员数据**:
- 从当前期次的学员列表读取
- 实时统计，确保数据最新

**课程配置**:
- 从Session表读取课程性别类型
- 从课程配置读取其他设置

**中心信息**:
- 从Center表读取中心名称
- 用于生成区域名称（如"XX禅修中心A区"）

### 8.2 配置存储

**存储位置**:
- 保存到 `meditation_hall_config` 表
- `layout_config` 字段存储JSON配置
- 其他必要字段自动填充

**存储内容**:
- 模板类型
- 行列数
- 区域划分（sections）
- 编号方式
- 座位前缀

### 8.3 向后兼容

**兼容策略**:
- 新系统生成的配置使用新格式
- 旧配置可以继续使用（Legacy模式）
- 提供迁移工具（可选）

---

## 九、用户体验优化

### 9.1 操作简化

**减少用户输入**:
- 不需要理解坐标系统
- 不需要手动计算容量
- 不需要配置sections
- 只需要调整行列数（可选）

**智能默认值**:
- 所有配置都有合理的默认值
- 用户可以直接使用默认配置
- 也可以根据实际情况微调

### 9.2 实时反馈

**实时预览**:
- 调整行列数时，预览实时更新
- 容量统计实时计算
- 使用率实时显示

**即时验证**:
- 输入时即时验证
- 错误即时提示
- 建议即时显示

### 9.3 帮助和引导

**上下文帮助**:
- 每个步骤都有简短说明
- 关键概念有工具提示
- 复杂操作有引导动画

**错误提示**:
- 清晰的错误信息
- 具体的解决建议
- 避免技术术语

---

## 十、实施优先级

### P0（必须实现）

1. **3种模板定义**
   - A区（女众独立）
   - B区（男众独立）
   - 混合园区（双性）

2. **自动数据读取**
   - 学员数据统计
   - 课程配置读取

3. **智能配置生成**
   - 模板推荐
   - 行列数自动计算
   - 区域划分自动生成

4. **简化界面**
   - 模板选择界面
   - 配置预览界面
   - 行列数调整控件

### P1（重要改进）

1. **容量验证和提示**
2. **区域划分验证**
3. **实时预览优化**
4. **帮助和引导**

### P2（可选优化）

1. **可视化拖拽调整**（如果用户需要更精细控制）
2. **配置模板保存**（用户可以保存常用配置）
3. **批量配置**（一次配置多个期次）

---

## 十一、关键设计决策

### 11.1 为什么只保留3种模板？

**原因**:
- 覆盖所有实际使用场景
- 减少用户选择困难
- 简化系统复杂度

**扩展性**:
- 如果未来有新的场景，可以添加新模板
- 但当前3种模板已经足够

### 11.2 为什么自动生成配置？

**原因**:
- 用户是非技术人员
- 减少学习成本
- 减少配置错误

**灵活性**:
- 用户仍可以调整行列数
- 系统提供推荐值，但不强制

### 11.3 为什么只调整行列数？

**原因**:
- 行列数是最直观的参数
- 其他配置（区域划分、编号方式）可以自动计算
- 减少用户困惑

**未来扩展**:
- 如果用户需要更精细控制，可以提供高级模式
- 但默认模式保持简单

---

## 十二、测试场景

### 12.1 单性课程测试

**场景1**: 女众单性课程，80人
- 选择模板1（A区）
- 系统自动生成12行×8列配置
- 自动划分旧生区（前2-3排）和新生区

**场景2**: 男众单性课程，60人
- 选择模板2（B区）
- 系统自动生成10行×7列配置
- 自动划分旧生区和新生区

### 12.2 双性课程测试

**场景3**: 双性课程，120人（60女+60男）
- 选择模板3（混合园区）
- 系统自动生成15行×10列配置
- 自动划分女众区（5列）和男众区（5列）
- 每个区域内部再划分旧生区和新生区

**场景4**: 双性课程，100人（50女+50男）
- 选择模板3（混合园区）
- 系统自动生成12行×10列配置
- 女众区：12行×5列=60座（B1-B60）
- 男众区：12行×5列=60座（A1-A60）

### 12.3 边界情况测试

**场景5**: 人数接近上限
- 单性课程99人 → 系统提示接近上限，建议检查
- 双性课程149人 → 系统提示接近上限，建议检查

**场景6**: 人数很少
- 单性课程20人 → 系统生成最小配置（8行×4列）
- 双性课程30人（15女+15男）→ 系统生成最小配置

---

## 十三、总结

### 13.1 设计优势

1. **极简操作**: 用户只需选择模板和调整行列数
2. **智能自动化**: 系统自动读取数据和生成配置
3. **覆盖全面**: 3种模板覆盖所有使用场景
4. **用户友好**: 非技术人员也能轻松使用

### 13.2 关键特性

- ✅ 模板驱动，无需理解复杂概念
- ✅ 自动数据读取，无需手动输入
- ✅ 智能配置生成，减少错误
- ✅ 实时预览反馈，所见即所得
- ✅ 简单调整，只需行列数

### 13.3 实施建议

1. **第一阶段**: 实现3种模板和自动配置生成
2. **第二阶段**: 优化界面和用户体验
3. **第三阶段**: 添加高级功能和扩展

---

**文档版本**: 1.0  
**最后更新**: 2025-11-15

