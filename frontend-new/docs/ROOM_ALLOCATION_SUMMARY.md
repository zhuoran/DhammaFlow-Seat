# 房间分配模块当前实现说明

> 版本：草案 v0.1 · 2025-XX-XX
> 用途：概述当前 `/allocations*` 系列页面的功能、布局和交互，供产品/设计 Review 参考。

---

## 1. 导航与入口
- **房间分配（/allocations）**：分配控制台。
- **房间工作台（/allocations/manual）**：目前承载手动调整 + 房间总览。
- **房间总览（/allocations/result）**：现阶段与工作台复用同一组件（RoomBoardPage），计划后续合并。

## 2. 分配控制台（/allocations）
- **统计卡片**：学员总数、已分配、待分配、房间数量。
- **冲突提示**：以数字形式展示冲突总量，提供「前往手动调整」「查看结果」按钮。
- **操作按钮**：
  - `开始自动分配`：调用 `allocationApi.triggerAutoAllocation`。
  - `重新分配`：调用 `allocationApi.clearAllocations` 后允许再次自动分配。
- **结果提示**：显示最近一次自动分配的结果（成功/失败）。

## 3. 房间工作台（/allocations/manual）
- **顶部**：`Segmented` 控件切换“全部/女众/男众”；`床位交换`按钮进入交换模式。
- **左侧列**：
  - “待分配学员”：列出所有尚未分配的学员，显示性别/类型标签。每个学员下方列出过滤后房间列表（按钮），点击进入指派 Modal。
- **中间主区**：
  - 样式：房间卡片 + 房间内床位的“卡片网格”。
  - 每张房间卡片显示：房号、性别、当前入住人数/容量。
  - 床位卡片显示：学员姓名 + 床位号；空床显示“空床 x”。
  - 操作：
    - 点击有学员的床位（在交换模式时）会高亮；选择两人后可执行交换。
    - “移除”按钮可释放床位（调用 `deleteAllocation`）。
    - 空床位暂未提供“指派”按钮（边栏学员按钮直接打开 Modal）。
- **右侧列**：“操作记录”占位（待完善）。
- **指派流程**：弹出 Modal 显示可用床位列表，选择后提交 `createAllocation`。
- **交换流程**：进入交换模式 → 选择两个床位 → 点击“执行交换”调用 `swapAllocations`。

## 4. 房间总览（/allocations/result）
- **当前状态**：与房间工作台复用同一组件，仅入口不同；暂无明确“确认/导出”流程，仅提供浏览 + 指派 + 交换。
- **打印按钮**：`window.print()` 实现打印，暂无 PDF/Excel 导出。

## 5. 数据依赖
- `currentCenter` / `currentSession` 由顶栏选择，Context 提供。
- React Query hooks：`useRooms`、`useStudents`、`useAllocations`、`useAllocationConflicts`（控制台使用）。
- 床位列表 (`bedApi.fetchBeds`) 在工作台加载时拉取一次并存于 state。

## 6. 已知局限
1. **入口重复**：`/allocations/manual` 与 `/allocations/result` 功能重叠，需合并为单页。
2. **冲突说明不足**：控制台只显示数字，缺少类型与快捷处理。
3. **床位可视化有限**：房间卡片虽有床位格子，但仍以文字为主，缺少更直观的状态提示（冲突/空/男女等）。
4. **操作记录未实现**：右侧“操作记录”卡片为占位，未能记录撤销等历史。
5. **打印/导出能力不足**：结果页仅能打印，尚未提供确认方案、PDF/Excel 导出。
6. **待分配学员筛选缺失**：无法按性别/类型筛选或快速定位。

---

> 请在 Review 时指出优先级最高的体验痛点，以便下一轮迭代集中修复。
