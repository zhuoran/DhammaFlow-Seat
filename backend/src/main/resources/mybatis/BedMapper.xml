<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cc.vipassana.mapper.BedMapper">

    <sql id="base_column">
        id, room_id, bed_number, position, status, created_at, updated_at
    </sql>

    <resultMap id="BaseResultMap" type="cc.vipassana.entity.Bed">
        <id column="id" property="id"/>
        <result column="room_id" property="roomId"/>
        <result column="bed_number" property="bedNumber"/>
        <result column="position" property="position"/>
        <result column="status" property="status"/>
        <result column="created_at" property="createdAt"/>
        <result column="updated_at" property="updatedAt"/>
    </resultMap>

    <select id="selectAll" resultMap="BaseResultMap">
        SELECT <include refid="base_column"/>
        FROM bed ORDER BY room_id, bed_number
    </select>

    <select id="selectByRoomId" resultMap="BaseResultMap">
        SELECT <include refid="base_column"/>
        FROM bed WHERE room_id = #{roomId} ORDER BY bed_number
    </select>

    <select id="selectById" resultMap="BaseResultMap">
        SELECT <include refid="base_column"/>
        FROM bed WHERE id = #{id}
    </select>

    <select id="selectAvailableByRoomId" resultMap="BaseResultMap">
        SELECT <include refid="base_column"/>
        FROM bed WHERE room_id = #{roomId} AND status = 'AVAILABLE'
        ORDER BY bed_number
    </select>

    <select id="countAvailableByRoomId" resultType="int">
        SELECT COUNT(*) FROM bed WHERE room_id = #{roomId} AND status = 'AVAILABLE'
    </select>

    <select id="selectByStatus" resultMap="BaseResultMap">
        SELECT <include refid="base_column"/>
        FROM bed WHERE status = #{status} ORDER BY room_id, bed_number
    </select>

    <insert id="insert" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO bed (room_id, bed_number, position, status, created_at, updated_at)
        VALUES (#{roomId}, #{bedNumber}, #{position}, #{status}, NOW(), NOW())
    </insert>

    <insert id="insertBatch" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO bed (room_id, bed_number, position, status, created_at, updated_at)
        VALUES
        <foreach collection="beds" item="bed" separator=",">
            (#{bed.roomId}, #{bed.bedNumber}, #{bed.position}, #{bed.status}, NOW(), NOW())
        </foreach>
    </insert>

    <update id="updateStatus">
        UPDATE bed SET status = #{status}, updated_at = NOW() WHERE id = #{id}
    </update>

    <update id="update">
        UPDATE bed SET room_id = #{roomId}, bed_number = #{bedNumber},
            position = #{position}, status = #{status}, updated_at = NOW()
        WHERE id = #{id}
    </update>

    <delete id="delete">
        DELETE FROM bed WHERE id = #{id}
    </delete>

    <delete id="deleteByRoomId">
        DELETE FROM bed WHERE room_id = #{roomId}
    </delete>

    <select id="count" resultType="int">
        SELECT COUNT(*) FROM bed
    </select>

    <select id="countByRoomId" resultType="int">
        SELECT COUNT(*) FROM bed WHERE room_id = #{roomId}
    </select>

</mapper>
