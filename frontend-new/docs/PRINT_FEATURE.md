# 分配结果打印功能说明文档

**完成日期**: 2025-11-07
**版本**: 2.0

---

## 功能概述

为禅修中心分配结果页面增加了完整的打印功能，采用**卡片式布局**与页面保持一致，支持按楼层分组、按性别分开打印。

---

## 核心特性

✅ **卡片式布局** - 与分配结果页面保持一致的可视化效果
✅ **按楼层分组** - 自动按楼层组织房间显示
✅ **简化学员信息** - 只显示姓名、年龄、床位号
✅ **性别分开打印** - 男众/女众 性别分开打印
✅ **A4纸张优化** - 自动分页，适配A4纸张打印
✅ **简洁统计** - 房间、学员、已入住三个关键数据
✅ **打印控制栏** - 打印时自动隐藏

---

## 页面布局

### 打印页面结构

```
┌─────────────────────────────────────┐
│  禅修中心名称                        │
│  课程期次 | 课程类型                 │
│  男众/女众/全部分配结果              │
├─────────────────────────────────────┤
│  房间: XX  学员: XX  已入住: XX      │  统计信息
├─────────────────────────────────────┤
│  1楼                                 │
│  ┌──────┐ ┌──────┐ ┌──────┐        │
│  │101房 │ │102房 │ │103房 │  卡片  │
│  │      │ │      │ │      │  式布  │
│  │张三  │ │李四  │ │无学员 │  局   │
│  │28岁  │ │30岁  │ │      │       │
│  │床位1号│ │床位2号│ │      │       │
│  └──────┘ └──────┘ └──────┘        │
│                                     │
│  2楼                                 │
│  ┌──────┐ ┌──────┐ ...             │
│  │201房 │ │202房 │                │
│  └──────┘ └──────┘                │
│                                     │
│  禅修中心智能排床系统 | 日期        │  页脚
└─────────────────────────────────────┘
```

---

## 主要功能

### 1. 控制栏 (打印时自动隐藏)

**位置**: 页面顶部

**功能**:
- **性别选择**: 全部 / 男众 / 女众
- **打印按钮**: 打开浏览器打印对话框
- **返回按钮**: 返回分配结果页面

### 2. 标题信息

```
禅修中心名称
课程期次: XXXX | 课程类型
男众/女众/全部分配结果
```

### 3. 统计面板

三个关键数据指标：
- **房间**: 本次打印涉及的房间总数
- **学员**: 已分配的学员总数
- **已入住**: 有学员入住的房间数

### 4. 房间卡片 (按楼层分组)

#### 卡片结构

```
┌─────────────────────┐
│ 楼号 房号            │  <- 房间标识
│ 容量 | 入住情况      │  <- 房间信息
├─────────────────────┤
│ ┌──────────────────┐ │
│ │ 学员姓名  年龄    │ │  <- 学员项
│ │ 床位: N号         │ │
│ └──────────────────┘ │
│ ┌──────────────────┐ │
│ │ 学员姓名  年龄    │ │
│ │ 床位: N号         │ │
│ └──────────────────┘ │
└─────────────────────┘
```

#### 卡片特点

- **布局**: Grid 响应式网格布局
- **间距**: 12px 卡片间距，适配A4纸张
- **每行**: 根据纸张宽度自动调整列数
- **分页**: 卡片尽量避免被分页截断

### 5. 学员信息

每个学员显示内容：
- **姓名** (加粗显示)
- **年龄** (灰色，右侧)
- **床位号** (蓝色加粗，单独一行)

**隐藏内容** (与分配结果页一致):
- ❌ 性别
- ❌ 城市
- ❌ 修学次数

---

## 使用流程

### 基本打印步骤

```
1. 在分配结果页面 (/allocations/result)
   ↓
2. 点击"打印分配表"按钮
   ↓
3. 进入打印页面 (/allocations/print)
   ↓
4. (可选) 选择性别过滤:
   - "全部" → 显示所有房间
   - "男众" → 只显示男众房间
   - "女众" → 只显示女众房间
   ↓
5. 点击"打印"按钮
   ↓
6. 浏览器打印对话框弹出
   ↓
7. 选择打印机 → 确认打印
   或
   选择"另存为PDF" → 保存
```

### 男女众分开打印示例

```
第一次:
1. 进入打印页面
2. 选择"男众"
3. 点击打印
4. 打印完成后获得男众报表

第二次:
1. 返回或刷新
2. 选择"女众"
3. 点击打印
4. 打印完成后获得女众报表
```

---

## 技术规格

### 布局设计

- **页面尺寸**: A4 (210mm × 297mm)
- **边距**: 15mm 四周
- **卡片宽度**: minmax(200px, 1fr) 响应式
- **卡片间距**: 12px
- **字体大小**:
  - 标题: 28px 加粗
  - 楼层: 16px 加粗
  - 房号: 13px 加粗
  - 学员名: 11px 加粗
  - 年龄: 11px 灰色
  - 床位: 11px 蓝色加粗

### 响应式卡片网格

```css
display: grid;
gridTemplateColumns: repeat(auto-fill, minmax(200px, 1fr));
gap: 12px;
```

**效果**:
- A4纸张宽度 (210mm - 30mm边距 = 180mm)
- 每张纸可放入约 4-5 个卡片 (200px × 4 = 800px ≈ 180mm)
- 自动适应不同页数，不强行固定列数

### 打印样式

```css
@media print {
  @page {
    size: A4;
    margin: 15mm;
  }

  /* 隐藏控制栏 */
  .no-print { display: none !important; }

  /* 防止卡片和标题被截断 */
  .ant-card { page-break-inside: avoid; }
  h1, h2 { page-break-after: avoid; }

  /* 优化分页 */
  body { margin: 0; padding: 0; }
}
```

---

## 文件修改清单

### 修改的文件

1. **`/app/allocations/result/page.tsx`**
   - Line 28: 添加 `PrinterOutlined` 导入
   - Line 445-447: 添加床位号显示
   - Line 595-605: 添加"打印分配表"按钮

### 新建的文件

2. **`/app/allocations/print/page.tsx`** (新建 - v2.0)
   - 卡片式布局打印页面
   - 按楼层分组功能
   - 简化学员信息显示

3. **`/PRINT_FEATURE.md`** (本文档 - v2.0)

---

## 使用示例

### 例1: 打印全部房间

```
用户场景: 需要打印所有房间的完整分配表

步骤:
1. 分配结果页面 → 点击"打印分配表"
2. 打印页面: 性别筛选保持"全部"
3. 点击"打印" → 选择打印机 → 确认
4. 获得完整的男众和女众分配表
```

### 例2: 分别打印男女众

```
用户场景: 需要为宿舍管理员分别提供男女众分配表

步骤:
第一阶段 - 打印男众:
1. 打印页面: 选择"男众"
2. 点击"打印" → 选择打印机 → 确认

第二阶段 - 打印女众:
1. 返回浏览器
2. 选择"女众"
3. 点击"打印" → 选择打印机 → 确认

结果: 获得两份独立的分配表
```

### 例3: 导出为PDF保存

```
用户场景: 需要将分配表保存为电子文件

步骤:
1. 打印页面选择需要的性别和格式
2. 按 Ctrl+P (Windows) 或 Cmd+P (Mac)
3. 打印对话框中选择:
   - "另存为PDF" (Chrome/Edge)
   - "Print to PDF" (Firefox)
4. 选择保存位置并保存

结果: 获得高质量的PDF文件
```

---

## 浏览器兼容性

| 浏览器 | 打印 | PDF导出 | 备注 |
|--------|------|--------|------|
| Chrome | ✅ | ✅ | 完全支持 |
| Firefox | ✅ | ✅ | 完全支持 |
| Safari | ✅ | ✅ | 完全支持 |
| Edge | ✅ | ✅ | 完全支持 |
| IE 11 | ⚠️ | ⚠️ | 不推荐 |

---

## 视觉设计

### 颜色方案

- **标题**: 深灰色 (#000)
- **卡片边框**: 蓝色 (#1890ff) / 灰色 (#d9d9d9)
- **床位号**: 蓝色加粗 (#1890ff)
- **年龄信息**: 浅灰色 (#999)
- **统计数据**: 彩色 (蓝#1890ff, 绿#52c41a, 橙#fa8c16)

### 卡片样式

```
满房 (occupancy === capacity):
  背景: #fafafa (浅灰)
  边框: #d9d9d9 (灰色)

未满房:
  背景: #fff (白色)
  边框: #1890ff (蓝色)
```

---

## 打印效果预览

### 单页布局

```
┌─────────────────────────────────────┐
│    禅修中心名称                      │ 5mm
│ 课程期次: 2025-1 | 十日课程          │
│ 男众分配结果                        │ 标题
├─────────────────────────────────────┤ 区域
│  房间: 10  学员: 25  已入住: 8      │ 统计
├─────────────────────────────────────┤
│ 1楼                                 │
│ ┌─────────┐ ┌─────────┐ ┌─────────┐│
│ │ 101房   │ │ 102房   │ │ 103房   ││
│ │ 2人房   │ │ 2人房   │ │ 2人房   ││
│ │         │ │         │ │         ││ 房间
│ │ 张三 28 │ │ 李四 30 │ │ 王五 32 ││ 卡片
│ │ 床位1号 │ │ 床位2号 │ │ 床位3号 ││
│ └─────────┘ └─────────┘ └─────────┘│
│                                     │
│ 2楼                                 │
│ ┌─────────┐ ┌─────────┐ ...       │
│ │ 201房   │ │ 202房   │           │
│ └─────────┘ └─────────┘           │
│                                     │ 卡片
│ (继续更多房间...)                  │
│                                     │
├─────────────────────────────────────┤
│  禅修中心智能排床系统 | 2025-11-07 │ 页脚
└─────────────────────────────────────┘
```

### 多页自动分页

- 每页根据空间自动排列卡片
- 楼层标题不会单独出现在页面底部
- 卡片避免被截断

---

## 故障排除

### 问题1: 打印时布局错乱

**原因**: 浏览器打印设置问题

**解决**:
1. 打开浏览器打印预览
2. 设置 → 边距选择"最小" 或 "无"
3. 启用"后台图形" (打印卡片边框)

### 问题2: 卡片在页面边缘被截断

**原因**: 打印机边距设置

**解决**:
1. 打印对话框 → 更多设置
2. 调整边距为 15mm
3. 确保纸张大小是 A4

### 问题3: PDF文件太大

**原因**: 包含图形和样式

**解决**:
1. 使用"标准" 或 "低质量" PDF设置
2. 关闭"打印背景颜色" (保留卡片边框)

### 问题4: 页面样式在打印中显示不同

**原因**: @media print 样式覆盖

**解决**:
1. 刷新页面
2. 禁用浏览器扩展
3. 使用隐身模式重试

---

## 后续改进建议

### 功能增强

1. **批量导出**:
   - 同时导出男女众PDF
   - 合并为单个文件

2. **自定义选项**:
   - 显示/隐藏学员信息字段
   - 自定义卡片大小
   - 自定义配色方案

3. **高级功能**:
   - 直接后端生成PDF (避免浏览器兼容性问题)
   - 打印模板选择 (紧凑/宽松)
   - 按建筑分组选项

### 样式优化

1. **可读性**:
   - 添加房间状态图标
   - 突出显示满房房间
   - 学员优先级标记

2. **美观度**:
   - 房间卡片投影效果
   - 渐变色背景
   - 图标和徽章

---

## 文档版本历史

| 版本 | 日期 | 主要变化 |
|------|------|--------|
| 1.0 | 2025-11-07 | 初始版本 - 表格式打印 |
| 2.0 | 2025-11-07 | 重新设计 - 卡片式打印，按楼层分组 |

---

## 维护和支持

本功能采用以下技术实现：

- **前端框架**: React 18 + TypeScript
- **UI库**: Ant Design 5
- **布局**: CSS Grid + Flexbox
- **打印**: CSS @media print

所有代码遵循以下原则：
- 语义化HTML结构
- 响应式设计
- 可访问性考虑
- 性能优化

---

**文档维护**: Claude Code
**更新日期**: 2025-11-07

